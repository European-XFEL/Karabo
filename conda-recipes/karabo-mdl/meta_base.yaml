# [[[cog
# from setuptools_scm import get_version
# from os import path as op
# root = op.join(op.dirname(cog.inFile), op.pardir, op.pardir)
# root = op.abspath(root)
# version = get_version(root=root)
# project_root = root.replace('\\', '\\\\')
# cog.outl(f'{{% set version = "{version}" %}}')
# cog.outl(f'{{% set project_root = "{project_root}" %}}')
# ]]]
# [[[end]]]

package:
  name: karabo-mdl
  version: {{ version }}

source:
  path: {{ project_root }}
  git_rev: {{ version }}

build:
  number: 0
  entry_points:
    - karabo-middlelayerserver=karabo.middlelayer_api.device_server:DeviceServer.main
    - ikarabo=karabo.interactive.ikarabo:main
  # This is needed to avoid removing egg files during packaging with setuptools
  preserve_egg_dir: True
  skip: true  # [win]

requirements:
  build:
    - python=3.6.7
    - jupyter_client=5.3.3
    - setuptools=42.0.1
    - setuptools_scm=3.3.3
    - flake8=3.3.0
    - pytest=6.1.1
  run:
    # [[[cog
    # import cog
    # import json
    # import os
    # import subprocess
    # conda = os.environ.get('CONDA_EXE', 'conda')
    # output = subprocess.check_output([conda, 'env', 'export', '-n', 'karabogui', '--json'])
    # for dep in json.loads(output)['dependencies']:
    #     if isinstance(dep, dict):
    #         continue
    #     cog.outl(f'- {dep}')
    # ]]]
    # [[[end]]]

test:
  imports:
    - karabo.native
    - karabo.common
    - karabo.middlelayer
