CUSTOM_BUILD=y
CWD=$(pwd)

MQTTC=paho.mqtt.c-1.3.6
MQTTCPP=paho.mqtt.cpp-1.1
MQTT_CPP=mqtt_cpp-8.0.0

echo
echo "### Trying to build and install $MQTTC"
echo

rm -rf $MQTTC

if [ ! -d "$MQTTC" ]; then
	tar -xf ${MQTTC}.tar
fi
cd $MQTTC
prefix=$INSTALL_PREFIX
# make
cmake -Bbuild -H. -DCMAKE_BUILD_TYPE=Release -DPAHO_WITH_SSL=OFF -DPAHO_ENABLE_TESTING=OFF \
      -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX
cmake --build build/ --target install

echo "-- move C libraries $CWD/$MQTTC/build/src/libpaho* to $INSTALL_PREFIX/lib/."
mv $CWD/$MQTTC/build/src/libpaho* $INSTALL_PREFIX/lib/.

MQTT_C_DIR=$INSTALL_PREFIX/lib   # C libraries directory

# build and install paho.mqtt.cpp

cd $CWD

echo
echo "### Trying to build and install $MQTTCPP"
echo



rm -rf $MQTTCPP
rm -rf $INSTALL_PREFIX/include/mqtt

if [ ! -d "$MQTTCPP" ]; then
        tar -xf ${MQTTCPP}.tar
fi
cd $MQTTCPP

cmake -Bbuild -H. -DCMAKE_BUILD_TYPE=Release -DPAHO_BUILD_DOCUMENTATION=FALSE -DPAHO_BUILD_SAMPLES=TRUE \
      -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \
      -DPAHO_MQTT_C_LIBRARIES=$MQTT_C_DIR/libpaho-mqtt3a.so
cmake --build build/ --target install

echo "-- move C++ libraries $CWD/$MQTTCPP/build/src/libpaho* to $INSTALL_PREFIX/lib/."
mv $CWD/$MQTTCPP/build/src/libpaho* $INSTALL_PREFIX/lib/.

cd $CWD

echo
echo "### Trying to build and install $MQTT_CPP"
echo

rm -rf $MQTT_CPP

if [ ! -d "$MQTT_CPP" ]; then
        tar -xf ${MQTT_CPP}.tar
fi
cd $MQTT_CPP
cmake -Bbuild -H. -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \
      -DBOOST_ROOT=$INSTALL_PREFIX \
      -DMQTT_BUILD_TESTS=OFF -DMQTT_BUILD_EXAMPLES=OFF
cmake --build build/ --target install

cd $CWD
