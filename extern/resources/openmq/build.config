#!/bin/bash

CUSTOM_BUILD=y
DEP_NAME="openmq5_0_1-binary-unix"
DEP_EXT="zip"
DEP_FULLNAME=$DEP_NAME.$DEP_EXT
_ARCHIVE_NAME=MessageQueue5.0.1

# The source of this installation
# wget http://download.oracle.com/mq/open-mq/5.0.1/b03/openmq5_0_1-binary-unix.zip

# unzip to default location
unzip -q $DEP_FULLNAME

# Adjust permissions
chmod -R u+w $_ARCHIVE_NAME

# Apply patch(es)
patch -p0 < xfel.patch

# Place in a non-versioned directory
DEFAULT_DIR=MessageQueue
mv $_ARCHIVE_NAME $DEFAULT_DIR

# Copy config files
mkdir -p $DEFAULT_DIR/etc/mq
cp etc/imqbrokerd.conf $DEFAULT_DIR/etc/mq/
cp etc/passfile.sample $DEFAULT_DIR/etc/mq/

# Install
[ -e $INSTALL_PREFIX/$DEFAULT_DIR ] && rm -rf $INSTALL_PREFIX/$DEFAULT_DIR
cp -r $DEFAULT_DIR $INSTALL_PREFIX

cp bin/imq $INSTALL_PREFIX/bin
cp bin/imqcmd $INSTALL_PREFIX/bin
