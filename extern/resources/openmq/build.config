#!/bin/bash

CUSTOM_BUILD=y
DEP_NAME="openmq5_1_3_linux"
DEP_EXT="zip"
DEP_FULLNAME=$DEP_NAME.$DEP_EXT
_ARCHIVE_NAME=MessageQueue5.1.3

# The source of this installation
# is here https://www.eclipse.org/downloads/download.php?file=/glassfish/glassfish-5.1.0.zip
# the mq folder is the only one stored for size

# unzip to default location
unzip -q $DEP_FULLNAME

# Adjust permissions
chmod -R u+w $_ARCHIVE_NAME

# Apply patch(es)
patch -p0 < xfel.patch

# Place in a non-versioned directory
DEFAULT_DIR=MessageQueue
mv $_ARCHIVE_NAME $DEFAULT_DIR

# Copy config files
mkdir -p $DEFAULT_DIR/etc/mq
cp etc/imqbrokerd.conf $DEFAULT_DIR/mq/etc
cp etc/passfile.sample $DEFAULT_DIR/mq/etc

# Install
[ -e $INSTALL_PREFIX/$DEFAULT_DIR ] && rm -rf $INSTALL_PREFIX/$DEFAULT_DIR
cp -r $DEFAULT_DIR $INSTALL_PREFIX

cp bin/imq $INSTALL_PREFIX/bin
cp bin/imqcmd $INSTALL_PREFIX/bin
