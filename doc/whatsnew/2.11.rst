***************************
What's New in Karabo 2.11.0
***************************

The **most relevant improvements**, fixes and changes are:

- MDL API CHANGE: The method `onInitialization` will not shutdown the instance anymore on exception.
- All API: The slot call ``slotGetTime`` takes an input argument now and provides the ``timeServerId``
  and the last reference timestamp.
- C++/Bound: Input channels of devices now have a property that shows the output
  channels that are configured to be connected but are not.

- C++/Bound: If an injected schema contains input or output channels or changes for the schema of an output channel, the respective channels are automatically (re-)created and need (re-)connection. That will happen automatically, but may need a few seconds.

- MDL API: New functions **hashToDict** and **dictToHash** are available. These function converts either nested dictionaries or hashes to their counterpart.

- The ``ProjectManager`` device is now compatible with a file backend. See :ref:`below <211_projectmanager>`.

- MAJOR: **Python** was upgraded to version **3.8**. In this process more dependencies were added or upgraded, see :ref:`below <211_deps>`.

- Compilation of device packages requires at least gcc version 7. Note that the default compiler on all supported platforms except Ubuntu16 fulfils that.

Deprecations
++++++++++++

- C++/Bound CHANGE: The properties ``useTimeServer`` and ``timeServerId`` have been deprecated and were removed from the devices
  since unused anyway (latter was only present in bound).

- MDL API: ``Injectable`` class is not required for Schema injection and deprecated. It will be removed with Karabo 2.13.

- MDL API: ``DeviceNode`` `properties` and `commands` are deprecated and scheduled for removal with Karabo 2.13.

- FW: The attribute configuration of the **unitSymbol** and **metricPrefixSymbol** in the graphical user interface has been deprecated and remvoved.
  For further details and future deprecations please have a look at the Karabo newsletter 25 (https://rtd.xfel.eu/docs/newsletter/en/latest/ticker_25.html).
  Further attribute settings from the graphical user interface have been deprecated and are scheduled for removal in Karabo 2.12.

- Karabo use on the Ubuntu16 platform is deprecated since that is not anymore maintained beyond April 2021.

- The old undocumented way to use ``getHistory("device").propertyName`` is deprecated and was removed.
  The ``getHistory``'s ``to`` argument is now optional. If missing, the current timestamp will be used.

- C++ when a devices updates its properties via the ``set`` function, but the update is invalid, now an exception is thrown (as in Bound).

.. _211_deps:

Table of changed dependencies
+++++++++++++++++++++++++++++

Please take note of the changed dependencies:


+--------------------+------------------+-----------+
| **library**        | **Old**          | **New**   |
+====================+==================+===========+
| atomicwrites       | NEW              | 1.4.0     |
+--------------------+------------------+-----------+
| attrs              | NEW              | 20.3.0    |
+--------------------+------------------+-----------+
| colorama           | NEW              | 0.4.4     |
+--------------------+------------------+-----------+
| cython             | 0.29.15          | 0.29.21   |
+--------------------+------------------+-----------+
| dateutil           | 2.2              | 2.8.1     |
+--------------------+------------------+-----------+
| flake8             | 3.3.0            | 3.8.4     |
+--------------------+------------------+-----------+
| flaky              | 3.4.0            | 3.7.0     |
+--------------------+------------------+-----------+
| importlib-metadata | NEW              | 3.3.0     |
+--------------------+------------------+-----------+
| iniconfig          | NEW              | 3.3.0     |
+--------------------+------------------+-----------+
| ipython            | 7.2.0            | 7.19.0    |
+--------------------+------------------+-----------+
| jedi               | 0.15.1           | 0.17.2    |
+--------------------+------------------+-----------+
| lxml               | 3.6.4            | 4.4.3     |
+--------------------+------------------+-----------+
| more-itertools     | NEW              | 8.6.0     |
+--------------------+------------------+-----------+
| numpy              | 1.13.3           | 1.15.4    |
+--------------------+------------------+-----------+
| packaging          | NEW              | 20.8      |
+--------------------+------------------+-----------+
| parso              | NEW              | 0.7.1     |
+--------------------+------------------+-----------+
| pexpect            | 3.1              | 4.8.0     |
+--------------------+------------------+-----------+
| pickleshare        | 0.7.3            | 0.7.5     |
+--------------------+------------------+-----------+
| pluggy             | NEW              | 0.13.1    |
+--------------------+------------------+-----------+
| prompt_toolkit     | 2.0.10           | 3.0.10    |
+--------------------+------------------+-----------+
| ptyprocess         | NEW              | 0.7.0     |
+--------------------+------------------+-----------+
| py                 | 1.4.31           | 1.10.0    |
+--------------------+------------------+-----------+
| pybind11           | NEW              | 2.6.1     |
+--------------------+------------------+-----------+
| pycodestyle        | 2.3.1            | 2.6.0     |
+--------------------+------------------+-----------+
| pyflakes           | 1.5.0            | 2.2.0     |
+--------------------+------------------+-----------+
| pygments           | 2.0.2            | 2.7.4     |
+--------------------+------------------+-----------+
| pyparsing          | 2.0.1            | 2.4.7     |
+--------------------+------------------+-----------+
| pytest             | 2.9.2            | 6.2.1     |
+--------------------+------------------+-----------+
| python             | 3.6.7            | 3.8.7     |
+--------------------+------------------+-----------+
| scipy              | 0.18.0           | 1.5.4     |
+--------------------+------------------+-----------+
| six                | 1.10.0           | 1.15.0    |
+--------------------+------------------+-----------+
| toml               | NEW              | 0.10.2    |
+--------------------+------------------+-----------+
| traitlets          | 4.2.2            | 5.0.5     |
+--------------------+------------------+-----------+
| wcwidth            | 0.1.7            | 0.2.5     |
+--------------------+------------------+-----------+
| zipp               | NEW              | 1.1.0     |
+--------------------+------------------+-----------+

.. _211_projectmanager:

Project Manager Updates
+++++++++++++++++++++++

In Karabo 2.11, the project manager is now able to use the filesystem as a backend.
This restores the possibility to run a fully featured karabo installation in
user space without needing an ExistDB server instance either through network or
inside a docker container.

This solution will force to adapt the ``run`` file of the project database manager.
The initial configuration of the ``ProjectManager`` has to change from:

.. code-block:: bash

  init='{"KaraboProjectDB":{"classId":"ProjectManager", "host": "thehostname", "port": 8080}}'

to:

.. code-block:: bash

  init='{"KaraboProjectDB":{"classId":"ProjectManager","projectDB":{"protocol": "exist_db", "exist_db":{"host": "thehostname", "port": 8080}}}}'

The default run file contains instructions on how to use the filesystem as a
projectDB backend. More info is available :ref:`here <run/all_local>`.
