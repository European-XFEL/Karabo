***************************
What's New in Karabo 2.14.0
***************************

This major Karabo release has an important dependency update: ``numpy`` and ``pint``. The new ``ufunc`` protocol is utilized and a few functions are
currently not supported by pint. Please have a look in the breaking changes.

Summary â€“ Release highlights
++++++++++++++++++++++++++++

Several important python packages have been updated.

- numpy 1.15.4 -> 1.21.4
- pint 0.7.1 -> 0.17
- scipy 1.5.4 -> 1.6.3
- pyzmq 18.1.0 -> 22.3.0
- cython 0.29.21 -> 0.29.24

Breaking Changes
++++++++++++++++

- The following functions are not supported with KaraboValues: ``numpy.positive``, ``numpy.divmod``, ``numpy.heaviside``,
  ``numpy.gcd``, ``numpy.lcm``, ``numpy.bitwise_and``, ``numpy.bitwise_xor``, ``numpy.bitwise_or``, ``numpy.invert``,
  ``numpy.left_shift``, ``numpy.right_shift``, ``numpy.logical_and``, ``numpy.logical_or``, ``numpy.logical_xor``,
  ``numpy.logical_not``, ``numpy.spacing``
- ``numpy.mean`` and ``numpy.std`` do not work anymore with ``QuantityValues`` that have a number (see examples).

Change of behaviour
+++++++++++++++++++

- Instantiantion of devices from all APIs now return after the "object connstruction" phase is completed.
  No code change is required on device level.

- The DataLoggers will ignore the ``archive`` flag and always archive a devices' conditions regardless of the
  value of this boolean.

- The ``archivePolicy`` attribute is removed from the middlelayer API.


Detailed Merge-Log
++++++++++++++++++

Bound/cpp core
==============

- TBD

MDL/Native core
===============

- TBD

Dependencies and deployment
===========================

- TBD

Documentation
=============

- TBD


Tests
=====

- TBD

Graphical User Interface
========================

- TBD


Examples (Numpy - KaraboValues)
===============================

.. code-block:: python

    def test_mean(self):
        # THIS DOES NOT WORK
        a = QuantityValue(3, "m", timestamp=self.t1)
        b = QuantityValue(1000, "mm", timestamp=self.t2)
        # Needs unit less values
        with self.assertRaises(ValueError):
            numpy.mean([a, b])

    def test_mean_no_dim(self):
        # THIS WORKS PARTIALLY
        a = QuantityValue(3, timestamp=self.t1)
        b = QuantityValue(1000, timestamp=self.t2)
        # unit less values works
        m = numpy.mean([a, b])
        self.assertEqual(m, 501.5)
        # We have a float now, no timestamp
        self.assertIsInstance(m, float)

    def test_mean_array(self):
        # THIS WORKS
        a = QuantityValue(numpy.array([1, 2, 3, 4]), timestamp=self.t1)
        m = numpy.mean(a)
        self.assertEqual(m, 2.5 * unit.dimensionless)
        self.assertEqual(m.timestamp, self.t1)

        b = QuantityValue(numpy.array([1, 2, 3, 4]), "m",
                          timestamp=self.t1)
        m = numpy.mean(b)
        self.assertEqual(m, 2.5 * unit.meter)
        self.assertEqual(m.timestamp, self.t1)